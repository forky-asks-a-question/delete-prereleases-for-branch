# delete-prereleases-for-branch

This action will retrieve the list of releases for the repository and delete any releases and associated tags that:
- Are marked as pre-release (it won't delete full releases)
- Include a pre-release branch tag in the format generated by [im-open/git-version-lite] (`major.minor.patch-<sanitized-branch-name>.<formated-date>`) in the release name or the release's tag.  
  - To sanitize the branch name, the characters `a-z, A-Z, 0-9 and -` are kept and any other character is replaced with `-`.  
- Are returned in the [list releases] API call. Depending on the permissions of the token it may return only published releases (not draft releases).

If the action runs into an issue deleting a specific release, it will generate a warning that can be viewed in the Summary section of the workflow rather than failing.  Errors retrieving the releases will still cause the action to fail though.

## Inputs
| Parameter      | Is Required | Description                                                   |
| -------------- | ----------- | ------------------------------------------------------------- |
| `github-token` | true        | A token with permission to delete releases in the repository. |
| `branch-name`  | true        | The branch the releases were created for.                     |

## Outputs
No Outputs

## Usage Examples

```yml
on:
  pull_request:
    types: [closed]
jobs:
  cleanup:
    runs-on: ubuntu-latest
    
    steps:
      - name: Clean up the releases that were created for this branch
        uses: im-open/delete-pre-releases-for-branch@v1.0.0
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          branch-name: ${{ github.head_ref }}
```

## Recompiling

If changes are made to the action's code in this repository, or its dependencies, you will need to re-compile the action.

```sh
# Installs dependencies and bundles the code
npm run build

# Bundle the code (if dependencies are already installed)
npm run bundle
```

These commands utilize [esbuild](https://esbuild.github.io/getting-started/#bundling-for-node) to bundle the action and
its dependencies into a single file located in the `dist` folder.

## Code of Conduct

This project has adopted the [im-open's Code of Conduct](https://github.com/im-open/.github/blob/master/CODE_OF_CONDUCT.md).

## License

Copyright &copy; 2021, Extend Health, LLC. Code released under the [MIT license](LICENSE).

[im-open/git-version-lite]: https://github.com/im-open/git-version-lite
[list releases]: https://docs.github.com/en/rest/reference/repos#list-releases